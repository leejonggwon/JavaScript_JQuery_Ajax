<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>

<body>
	<div id="map" style="width:500px;height:400px;"></div>

	<script src="./js/jquery-3.7.1.js"></script>
	<script type="text/javascript"
		src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5e0aaecf2df742e0783de488dbf0411f"></script>
	
	<script>

		//괴산군 관광지 데이터를 요청하는 함수 
		//1.관광지명, 주소, 위경도, 전화번호 데이터를 가져온다
		//2.가져온데이터를 객체형태로 저장한다
		// 	{tourNm:"", addr:"", lat:"", tel:"" }
		//3.광광지객체를 positions배열에 저장한다

		let getTourData = function () {

			let tourURL = "http://apis.data.go.kr/4460000/GetTourPlaceService/getTourPlaceInfo?serviceKey=49cba3a604889f44e0d4efb901d4050923a2bbb725e463dc3230aeb176e0e71b&pageIndex=10&firstIndex=1&dataType=JSON";
			$.ajax({
				url: tourURL,
				success: function (res) {
					let tourList = res.response.body.items.item;
					
					Kako(tourList)
				},
				error: function () {
					alert("요청실패");
				}
			});
		}

		let Kako = function (tourList) {
			var container = document.getElementById('map');
			var options = {
				center: new kakao.maps.LatLng(tourList[0].lat, tourList[0].lot), //위경도
				level: 10
			};

			var map = new kakao.maps.Map(container, options);

			var positions = []; // 빈 배열
			for (let i = 0; i < tourList.length; i++) {
				positions.push({
					content: `<div>관광지명: ${tourList[i].tourtile}</div><div>주소: ${tourList[i].roadNmAddr}</div><div>전화번호: ${tourList[i].instTelno}</div>`,
					latlng: new kakao.maps.LatLng(tourList[i].lat, tourList[i].lot)
				});
			}

			for (var i = 0; i < positions.length; i++) {
				// 마커를 생성합니다
				var marker = new kakao.maps.Marker({
					map: map, // 마커를 표시할 지도
					position: positions[i].latlng // 마커의 위치
				});

				// 마커에 표시할 인포윈도우를 생성합니다 
				var infowindow = new kakao.maps.InfoWindow({
					content: positions[i].content // 인포윈도우에 표시할 내용
				});

				// 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
				// 이벤트 리스너로는 클로저를 만들어 등록합니다 
				// for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
				kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
				kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
			}

			// 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
			function makeOverListener(map, marker, infowindow) {
				return function () {
					infowindow.open(map, marker);
				};
			}

			// 인포윈도우를 닫는 클로저를 만드는 함수입니다 
			function makeOutListener(infowindow) {
				return function () {
					infowindow.close();
				};
			}
		}


		getTourData();


	</script>
</body>

</html>